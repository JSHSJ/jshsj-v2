---
import IconPageLink from "./icons/Icon-PageLink.astro"

import ProjectList from "./ProjectList.astro"

import { Client } from '@notionhq/client';

// Initializing a client
const notion = new Client({
  auth: process.env.NOTION_KEY //process.env.NOTION_TOKEN
});


// const d = await notion.pages.retrieve({page_id: 'bdbabbec15604ec68353de3f3160c7fd'})
const allProjectsQuery = await notion.databases.query({database_id: '407731b52d4642d6a91e326ea9eb3a98'});
const allProjects = allProjectsQuery.results.map(page => ({
  id: page.id,
  url: page.url,
  techStack: page.properties.Techstack, // richtext
  // preview: page.properties.Preview
  description: page.properties.Description, // richtext
  url: page.properties.URL, // url
  name: page.properties.Name // plain text
})).filter(p => p.name.title.length > 0).slice(0, 3)
---


<section class="layoutContainer | projectReel">
  <div class="stack">
  <h2 class="typo-hollow typo-3xl -bold -with-dot" data-aside>Projekte</h2>
    <ProjectList projects={allProjects}></ProjectList>
      <div class="cluster box" style="border: var(--s-5) solid var(--text2); background: var(--surface2)">
        <a href="/projekte" class="link-with-icon">
        <IconPageLink></IconPageLink><span>Alle Projekte</span></a>
        <a href="https://github.com/JSHSJ" target="_blank" rel="noopener noreferrer" class="link-with-icon"><IconPageLink></IconPageLink><span>GitHub</span></a>
      </div>
  </div>
</section>

