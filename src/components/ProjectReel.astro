---
import NotionRichText from "./notion/NotionRichText.astro"
import NotionURL from "./notion/NotionURL.astro"
import NotionTitle from "./notion/NotionTitle.astro"

import IconPageLink from "./icons/Icon-PageLink.astro"

import { Client } from '@notionhq/client';

// Initializing a client
const notion = new Client({
  auth: process.env.NOTION_KEY //process.env.NOTION_TOKEN
});


// const d = await notion.pages.retrieve({page_id: 'bdbabbec15604ec68353de3f3160c7fd'})
const allProjectsQuery = await notion.databases.query({database_id: '407731b52d4642d6a91e326ea9eb3a98'});
const allProjects = allProjectsQuery.results.map(page => ({
  id: page.id,
  url: page.url,
  techStack: page.properties.Techstack, // richtext
  // preview: page.properties.Preview
  description: page.properties.Description, // richtext
  url: page.properties.URL, // url
  name: page.properties.Name // plain text
})).filter(p => p.name.title.length > 0).slice(0, 3)
---

<style>
.projectReel {

}

/* h2 {
    writing-mode: vertical-rl;
    text-orientation: sideways;
  } */

</style>
<section class="layoutContainer | projectReel">
  <div class="stack">
  <h2 class="typo-hollow typo-3xl -bold" data-aside>Projekte</h2>
  <div class="stack">
    {allProjects.map((project) => (
        <article class="stack -layout-3xs">
          <h3 class="typo-l -bold"><NotionTitle content={project.name}></NotionTitle></h3>
          <NotionRichText content={project.description}></NotionRichText>
          <div class="cluster">
          <NotionURL content={project.url}>
            Besuchen
          </NotionURL>
          <a href="">Mehr</a>
          </div>
        </article>
      ))}
      <div class="cluster box" style="border: var(--s-2) solid var(--brand);">
        <a href="" class="link-with-icon">
        <IconPageLink></IconPageLink><span>Alle Projekte</span></a>
        <a href="https://github.com/JSHSJ" target="_blank" rel="noopener noreferrer" class="link-with-icon"><IconPageLink></IconPageLink><span>GitHub</span></a>
      </div>
  </div>
</section>

